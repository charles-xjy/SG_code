# **SG-formula**

### **一、 研究内容 (Research Content)**

本课题主要围绕双层卫星网络架构下的协同计算性能展开，具体涵盖以下三个层面的理论研究：

#### **1. 基于随机几何的低轨卫星网络时空动态特性建模**

针对低轨卫星高动态性带来的网络拓扑时变问题，利用**随机几何（Stochastic Geometry）**理论构建星地及星间链路的几何模型。

- **具体路径：** 通过推导最大接入角 $\phi_{\max}$、最近卫星接入角 $\phi_0$ 的概率密度函数（PDF），以及卫星过顶时间 $T_{pass}$ 的累积分布函数（CDF），量化卫星对地覆盖及层间可视性的物理窗口。
- **核心支撑：** 建立基于球冠几何的路径长度与中心角 $\theta$ 的解析关系，为后续通信链路的可用性分析奠定物理层基础。

#### **2. 融合排队论的节点服务可用性与异构负载分析**

为解决物理可见性与服务可用性不匹配的问题，引入**排队论（Queueing Theory）\**与\**泊松点过程（PPP）稀疏化定理**，对卫星节点的实际计算能力进行统计建模。

- **具体路径：** 将单颗卫星建模为 M/M/1 排队系统，推导系统逗留时间分布；结合任务到达率 $\lambda$ 与服务率 $\mu$，定义“有效服务卫星”的筛选准则（即排队等待时间需满足特定时限约束 $\bar{T}_{pass}/5$）。
- **核心支撑：** 利用 MPPP（标记泊松点过程）理论，推导有效卫星密度 $\lambda_{eff}$ 及特定搜索区域 $S$ 内的有效协同节点期望数 $N_{eff}$。

#### **3. 约束条件下的协同计算性能评估与资源反演机制**

结合**Amdahl并行计算定律**，建立多星协同环境下的任务完成概率闭式解析模型，并提出基于服务质量（QoS）约束的资源反向优化方法。

- **具体路径：** 将多星协同系统等效为具有合成服务率 $\mu_{eff}$ 的虚拟单节点，构建在时延阈值 $\tau$ 下的任务完成概率 $P_{task}$ 表达式。在此基础上，通过数学反演，求解满足可靠性需求的最小卫星节点数 $N_{min}$ 及其对应的最优空间搜索半径 $R_{search}$。
- **核心支撑：** 考虑任务中不可并行部分 $f$ 对加速比的非线性限制，实现从应用层需求到物理层资源配置的跨层映射。

------

### **二、 研究目标 (Research Objectives)**

1. **构建“几何-排队-计算”跨层解析框架：** 突破传统仿真依赖，建立一套融合轨道几何特性、随机任务负载与并行计算原理的统一数学分析框架，实现对星地协同计算系统性能的**闭式（Closed-form）解算**。
2. **实现随机任务流下的确定性QoS保障：** 针对卫星网络计算资源的时空分布不均特性，通过理论模型精确量化“任务完成概率”与“资源投入量”之间的定量关系，为高可靠性通信计算融合网络提供理论支撑。
3. **确立资源受限下的最优空间搜索策略：** 解决上层卫星在卸载任务时“搜索范围”与“资源获取”之间的权衡问题，输出基于任务时延敏感度的最优搜索半径 $R_{search}$ 计算方法，实现网络能效与服务质量的帕累托最优。

------

### **三、 拟解决的关键科学问题 (Key Scientific Problems)**

#### **1. 高动态拓扑下的“时空-负载”强耦合可用性度量问题**

- **问题阐述：** 卫星节点的可用性不仅取决于几何上的“可见性”（物理层），更受限于其当前的排队“负载状态”（网络层）。由于卫星高速运动导致的服务窗口（$T_{pass}$）极为有限，如何将瞬态的几何连接时间与随机的排队等待时间进行联合建模，是准确评估节点可用性的难点。
- **解决思路：** 本研究拟通过引入MPPP ，将物理空间的节点密度映射为服务空间的有效密度，以此解耦时空动态性与负载随机性。

#### **2. 非线性并行加速约束下的分布式时延尾部机理**

- **问题阐述：** 在分布式协同计算中，增加计算节点 $N$ 对降低系统时延的贡献受制于 Amdahl 定律中的不可并行比例 $f$，呈现出显著的边际效应递减特征。如何在考虑这种非线性加速特性的前提下，精确刻画系统总逗留时间的尾部分布（即 $P(T \le \tau)$），是资源定维的关键。
- **解决思路：** 拟通过构建等效合成服务率 $\mu_{eff}$，将并行计算参数内嵌至排队系统的指数分布参数中，从而在概率域内解析任务时延的分布规律。

#### **3. 面向QoS保障的计算资源空间域最优匹配与反演问题**

- **问题阐述：** 传统资源调度多为“正向优化”（即给定资源求性能），而在星上边缘计算场景中，往往需要“逆向反演”（即给定 QoS 目标 $P_{task}$ 与 $\tau$，反推所需的最小网络拓扑结构）。如何在多维几何参数（$R, h$）与网络参数（$\lambda, \mu$）的复杂约束下，获得搜索半径 $R_{search}$ 的解析解，是实现按需服务（On-Demand Service）的核心挑战。
- **解决思路：** 拟建立任务完成概率关于节点数量的单调函数关系，利用反函数法推导最小节点数 $N_{min}$ 的闭式解，进而结合球冠几何公式反解空间搜索边界。

------

### 四、 公式推导

对于最大接入角，由卫星的波束宽度决定：
$$
\phi_{\max} =
\begin{cases}
arcsin\left( \frac{R+h}{R}\sin\frac{\gamma}{2} \right) - \frac{\gamma}{2}, & \gamma < \gamma_0 \\[6pt]
arccos\left( \frac{R}{R+h} \right), & \gamma > \gamma_0
\end{cases}
$$

其中：

- $\gamma_0=\frac{arcsin(R/R+h)}2$

#### 最近卫星的接入角 $φ_0 $的 PDF（PPP 最近点）:

$$
f_{\phi_0}(\phi) =
\frac{N}{2} sin\phi \;
exp\!\left[-\frac{N}{2}(1-cos\phi)\right]
$$

卫星的线速度表达式如下：
$$
v = \sqrt{\frac{GM}{R+h}}
$$
所对应球冠上的路径长度：
$$
l = (R+h)\,\theta
$$
中心角$\theta$的球面余弦公式:
$$
\theta = arccos\big(
cos\phi_{\max}cos\phi_0
+ sin\phi_{\max}sin\phi_0cos\delta
\big)
$$

#### 卫星接入时间可表达为：

$$
T_{AB} =
\sqrt{\frac{(R+h)^3}{GM}}
\cdot
arccos\big(
cos\phi_{\max}cos\phi_0
+ sin\phi_{\max}sin\phi_0cos\delta
\big)
$$

接入时间的条件概率：
$$
P(T_{AB} < t)
=
P\!\left(
cos\delta >
\frac{
cos\!\left(\sqrt{\frac{GM}{(R+h)^3}}\, t\right)
- cos\phi_{\max}cos\phi_0
}{
sin\phi_{\max}sin\phi_0
}
\right)
$$
对于$\delta$ 在[0,2$\pi$]上均匀分布，$cos\delta$的CDF：
$$
P(\cos\delta > u) =
\begin{cases}
1, & u < -1 \\[4pt]
\frac{1}{\pi}arccos(u), & u\in[-1,1] \\[4pt]
0, & u > 1
\end{cases}
$$
接入时间的cdf：
$$
F_{T_{AB}}(t)
=
\int_{0}^{\phi_{\max}}
f_{\phi_0}(\phi)
\cdot
\frac{1}{\pi}
arccos
\left(
\frac{
cos\!\left(\sqrt{\frac{GM}{(R+h)^3}}\, t\right)
- cos\phi_{\max}cos\phi
}{
sin\phi_{\max}sin\phi
}
\right)
\, d\phi
$$

#### 平均接入时间：

$$
\bar{T}_{AB} =
\sqrt{\frac{(R+h)^3}{GM}}
\int_{0}^{\phi_{\max}}
\int_{0}^{2\pi}
\theta \;
f_{\delta}(\delta)\,
f_{\phi_0}(\phi)
\; d\delta\, d\phi
$$

Let $R_E$ denote the radius of the Earth. The orbital radii of the lower-layer computing satellites and the upper-layer remote sensing satellites are defined as $R_1 = R_E + h_1$ and $R_2 = R_E + h_2$, respectively, where $h_1$ and $h_2$ are their orbital altitudes ($h_2 > h_1$).

![image-20251130140504220](C:\Users\charl\AppData\Roaming\Typora\typora-user-images\image-20251130140504220.png)

对于下面公式给出示意图
$$
\cos \theta = \frac{R_1^2 + R_2^2 - R_{\text{search}}^2}{2 R_1 R_2}
    \label{eq:cos_theta}
$$
球冠的公式如下：
$$
S = 2 \pi R_1^2 (1 - cos \theta)
    \label{eq:spherical_area}
$$
将公式(1)带入(2)可得$S$的最终表达式：
$$
S = \frac{\pi R_1}{R_2} \left[ R_{\text{search}}^2 - (R_2 - R_1)^2 \right]
    \label{eq:final_area}
$$
#### 计算任务分析：

在 M/M/1 稳定系统 ($\rho < 1$) 中，系统服务排队时间 $T$ 的**累积分布函数 (CDF)** $F_T(t)$ 定义为 $P(T \le t)$，即顾客在系统中停留时间不超过 $t$ 的概率，其公式为：

$$
F_T(t) = 1 - \rho e^{-(\mu - \lambda) t}, \quad t \ge 0
$$
其中：

- $t$ 是时间变量， $t \ge 0$。
- $\rho=\frac{\lambda}{\mu}$
- $\mu (1-\rho)$ 是有效服务率，它等于 $\mu - \lambda$。

#### MPPP分析：

泊松点过程稀疏化定理（PPP Thinning Theorem）是随机几何中的一个核心结论。该定理指出，如果对一个原始的泊松点过程（PPP，强度为 $\lambda(x)$）中的每一个点，都以一个独立于其他点的概率 $p(x)$ 将其保留下来，那么所有被保留下来的点集合，仍然构成一个新的泊松点过程。当卫星满足等待服务时间小于$\frac{\bar{T}_{pass}}5$，卫星才会参与协助计算。
$$
p_{\text{available}} = 1 - \rho e^{-(\mu - \lambda)\frac{\bar{T}_{pass}}5}
$$
对于MPPP，其卫星密度等于
$$
\lambda_{\text{eff}} = \lambda_{\text{real}} \times p_{\text{available}}
$$
Given the satellite density $\rho$ of the lower layer, the expected number of available computing satellites $m$ within the coverage area is given by:
$$
N_{eff} = \left\lfloor \lambda_{eff} \cdot S \right\rfloor = \left\lfloor \lambda_{eff} \cdot \frac{\pi R_1}{R_2} \left( R_{\text{search}}^2 - (h_2 - h_1)^2 \right) \right\rfloor
$$

#### **Amdahl 定律加速比公式：**  

$$
S_{Amdahl} = \frac{1}{f + \frac{1-f}{N_{eff}}}
$$

其中对于参数的说明：

- $f$: 不可并行部分的比例（例如，预处理、后处理、通信开销）。
- $N$: 参与协同计算的卫星（GPU）数量。

#### **卫星选择策略：**

因此协助计算后整个系统可以被看作是一个新的MM1系统，$\lambda$依旧不变，但是$\mu_{eff}=\mu \cdot S_{Amdahl}$

因此系统总逗留时间小于$\tau$的概率可以表示为以下公式：
$$
F_{W}(\tau) = 
\begin{cases}
    0 & \text{if } \tau < 0 \\
    1 - e^{-(\mu_{eff} - \lambda)\tau} & \text{if } \tau \ge 0
\end{cases}
$$

此时考虑卫星与地面用户上下行的时间：
$$
\tau=\tau_W + T_{trans} \approx \tau_W
$$
在本研究所考虑的场景中，卫星已具备完整的星载智能处理能力，用户侧任务的主要计算与推理均在卫星端完成。因此，用户与卫星之间的交互仅涉及少量文本级别的信息传递，数据量极为有限。相较于卫星可见时间尺度，其上下行通信时延可忽略不计，对整体任务完成时间不构成实质性影响。

#### 反解出N：

我们令这个概率等于给定的任务完成概率 
$$
P_{task} = 1 - e^{-(\mu_{eff} - \lambda)\tau}
$$
从上式中解出指数项：
$$
e^{-(\mu_{eff} - \lambda)\tau} = 1 - P_{task}
$$
对两边取自然对数 $\ln$即可解出 $(\mu_{eff} - \lambda)$，因此，**有效服务率 $\mu_{eff}$** 的表达式为：
$$
\mu_{eff} - \lambda = - \frac{1}{\tau} \ln(1 - P_{task})
$$
将参数带入进行化简可得：
$$
S_{Amdahl} = \frac{\lambda}{\mu} - \frac{1}{\mu \tau} \ln(1 - P_{task})
$$
得到卫星数量 $N$ 的闭式表达式
$$
N \ge \frac{(1-f) \left( \frac{\lambda}{\mu} - \frac{1}{\mu \tau} \ln(1 - P_{task}) \right)}{1 - f \left( \frac{\lambda}{\mu} - \frac{1}{\mu \tau} \ln(1 - P_{task}) \right)}
$$
由于 $N$ 必须是**整数**，因此您需要的最小卫星数量 $N_{min}$ 为：
$$
N_{min} = \lceil N \rceil = \left\lceil \frac{(1-f) \left( \frac{\lambda}{\mu} - \frac{1}{\mu \tau} \ln(1 - P_{task}) \right)}{1 - f \left( \frac{\lambda}{\mu} - \frac{1}{\mu \tau} \ln(1 - P_{task}) \right)} \right\rceil
$$
其中：

- $N$: 参与协同计算的卫星数量。
- $P_{task}$: 期望的任务完成概率（即系统总逗留时间小于 $\tau$ 的概率）。
- $\tau$: 给定的时间限制。
- $\lambda$: 任务到达率。
- $\mu$: 单个卫星（系统）的服务率。
- $f$: 任务中不可并行部分的比例。

#### 搜索半径分析：

假设 $N_{eff}$ 是由排队论分析得出的卫星数量 $N$，则搜索半径 $R_{\text{search}}$ 的闭式表达式为：
$$
R_{\text{search}} = \sqrt{\frac{N_{min} \cdot R_2}{\lambda_{eff} \cdot \pi R_1} + (h_2 - h_1)^2}
$$
其中：

- $N$: 来自排队论的最小卫星数量（$N_{min}$）。
- $\lambda_{eff}$: 有效任务到达率。
- $R_1, R_2, h_1, h_2$: 关于卫星高度的几何参数。
